- view: unique_counts
  derived_table:
    sql: |
      SELECT 
        COUNT(DISTINCT CASE WHEN (economistonline_hit_data.hit_source <> 7) THEN (economistonline_hit_data.visid_high ||'_'|| economistonline_hit_data.visid_low) ELSE NULL END) AS "economistonline_hit_data.unique_visitors",
        COUNT(CASE WHEN (economistonline_hit_data.post_page_event = 0) THEN 1 ELSE NULL END) AS "economistonline_hit_data.unique_views"
      FROM public.economistonline_hit_data AS economistonline_hit_data
      
      WHERE (economistonline_hit_data.exclude_hit = 0 and economistonline_hit_data.hit_source not in (5, 8, 9) and economistonline_hit_data.ip not in
      ('76.74.136.173',
      '208.93.112.82',
      '208.115.62.189',
      '208.88.49.116',
      '72.35.68.151',
      '122.99.116.252',
      '208.64.29.162',
      '64.151.64.36',
      '173.234.33.130',
      '212.34.152.222',
      '93.158.114.78',
      '78.153.204.52',
      '83.133.122.246',
      '208.115.48.247',
      '65.39.204.105',
      '64.34.165.189',
      '211.99.248.44',
      '64.71.140.53',
      '216.151.3.25',
      '208.115.62.204',
      '196.201.6.112',
      '78.110.165.82',
      '69.90.42.101',
      '67.58.96.43',
      '99.192.170.53',
      '118.127.32.144',
      '208.115.62.173',
      '216.155.155.184',
      '72.35.68.141',
      '216.93.249.82',
      '182.18.182.46',
      '199.36.105.26',
      '208.115.62.223',
      '66.90.103.248',
      '69.90.184.74',
      '77.79.11.40',
      '209.144.26.52',
      '213.108.251.31',
      '81.218.234.138',
      '65.18.195.129',
      '208.93.112.83',
      '208.115.62.190',
      '208.88.49.149',
      '72.35.68.152',
      '5.134.1.234',
      '72.46.128.170',
      '64.151.89.68',
      '74.126.82.60',
      '77.240.1.161',
      '91.236.116.217',
      '78.153.204.53',
      '65.39.204.98',
      '208.115.48.248',
      '65.39.204.107',
      '46.19.138.186',
      '202.85.221.97',
      '64.71.140.54',
      '216.151.3.26',
      '208.115.62.203',
      '196.201.6.110',
      '94.229.76.26',
      '69.90.42.103',
      '67.58.96.44',
      '95.141.34.234',
      '202.130.33.58',
      '204.2.244.20',
      '87.98.212.251',
      '72.35.68.142',
      '216.93.249.83',
      '182.18.182.48',
      '208.85.242.244',
      '208.115.62.224',
      '66.90.103.45',
      '69.90.184.75',
      '77.79.11.41',
      '209.144.26.53',
      '85.192.33.33',
      '219.117.207.179',
      '65.18.195.237',
      '208.93.112.80',
      '46.165.212.101',
      '208.88.49.150',
      '46.21.158.66',
      '5.134.1.235',
      '89.106.180.82',
      '69.59.152.4',
      '74.126.82.61',
      '77.240.1.162',
      '93.158.114.61',
      '78.153.204.54',
      '65.39.204.109',
      '208.115.48.249',
      '65.39.204.108',
      '46.19.138.190',
      '211.99.248.45',
      '64.71.140.55',
      '216.151.3.27',
      '208.115.62.231',
      '72.15.252.84',
      '94.229.69.74',
      '61.100.10.83',
      '67.58.96.45',
      '95.141.34.235',
      '202.130.33.59',
      '208.115.62.174',
      '87.98.212.252',
      '72.35.68.143',
      '216.93.249.84',
      '182.18.182.50',
      '208.85.242.245',
      '208.115.62.225',
      '66.90.104.22',
      '69.90.184.76',
      '202.157.154.21',
      '64.78.153.228',
      '213.108.251.33',
      '69.64.248.18',
      '65.39.204.112',
      '65.18.195.238',
      '208.93.112.81',
      '46.165.212.102',
      '208.88.49.151',
      '46.21.158.67',
      '5.134.1.236',
      '89.106.180.83',
      '208.113.96.148',
      '74.126.82.62',
      '77.240.1.163',
      '91.236.116.218',
      '204.2.244.17',
      '208.115.48.250',
      '173.234.233.90',
      '46.19.141.154',
      '202.85.221.98',
      '64.71.140.56',
      '38.109.170.50',
      '208.115.62.230',
      '72.15.252.85',
      '94.229.64.158',
      '61.100.10.85',
      '209.223.236.250',
      '95.141.34.236',
      '202.130.33.60',
      '176.56.226.140',
      '204.2.244.21',
      '87.98.212.223',
      '72.35.68.144',
      '216.93.249.85',
      '162.216.98.82',
      '208.85.242.246',
      '208.115.62.226',
      '66.90.104.24',
      '69.90.184.77',
      '202.157.154.2',
      '64.78.153.229',
      '85.192.33.35',
      '219.117.207.180',
      '65.39.204.113',
      '216.187.109.82',
      '114.23.33.58',
      '46.165.212.103',
      '209.250.31.21',
      '46.21.158.68',
      '201.235.255.70',
      '89.106.180.84',
      '64.151.91.132',
      '207.54.159.84',
      '77.240.1.164',
      '203.12.0.89',
      '208.115.62.185',
      '208.115.48.251',
      '64.120.46.202',
      '209.196.10.76',
      '211.99.248.46',
      '64.71.140.57',
      '199.36.111.226',
      '208.115.62.234',
      '72.15.252.86',
      '69.90.184.68',
      '61.100.10.87',
      '209.223.236.251',
      '216.185.196.42',
      '27.50.87.227',
      '176.56.226.142',
      '208.115.62.175',
      '118.88.21.35',
      '72.35.68.145',
      '216.93.249.86',
      '162.216.98.83',
      '208.85.242.247',
      '208.115.62.227',
      '70.32.33.122',
      '173.254.192.50',
      '202.157.154.3',
      '64.78.153.230',
      '213.108.251.35',
      '69.64.248.19',
      '65.39.204.99',
      '216.187.109.84',
      '114.23.33.59',
      '46.165.212.104',
      '209.250.31.22',
      '46.21.158.69',
      '201.235.255.71',
      '89.106.180.85',
      '200.143.186.100',
      '207.54.159.85',
      '77.240.1.165',
      '118.127.32.141',
      '204.2.244.19',
      '208.115.48.252',
      '173.208.58.234',
      '72.35.68.131',
      '202.85.221.99',
      '202.157.180.120',
      '38.109.170.51',
      '208.115.62.236',
      '74.63.64.48',
      '69.90.184.78',
      '203.142.12.49',
      '209.223.236.252',
      '216.185.196.43',
      '27.50.87.225',
      '176.56.226.144',
      '204.2.244.30',
      '118.88.21.36',
      '72.35.68.146',
      '209.190.168.36',
      '162.216.98.84',
      '208.85.242.250',
      '208.115.62.229',
      '70.32.39.42',
      '173.254.192.51',
      '64.39.226.82',
      '64.78.153.231',
      '202.157.191.67',
      '219.117.207.178',
      '65.39.204.100',
      '216.187.109.85',
      '114.23.33.60',
      '46.165.204.130',
      '209.250.31.23',
      '46.21.158.70',
      '201.235.255.72',
      '89.106.180.86',
      '200.143.186.101',
      '207.54.159.86',
      '77.240.1.166',
      '203.12.0.90',
      '208.115.62.186',
      '208.115.48.253',
      '173.234.117.146',
      '72.35.68.132',
      '83.166.171.123',
      '203.142.28.180',
      '199.36.111.227',
      '208.115.62.202',
      '74.63.64.47',
      '69.90.184.69',
      '222.73.34.60',
      '209.223.236.253',
      '216.185.196.44',
      '206.51.230.175',
      '208.93.114.66',
      '208.115.62.176',
      '118.88.21.37',
      '72.35.68.147',
      '209.190.168.37',
      '111.90.138.213',
      '208.85.242.251',
      '209.156.160.90',
      '69.147.230.98',
      '173.254.192.52',
      '64.39.226.83',
      '208.79.212.146',
      '202.157.191.84',
      '69.64.248.20',
      '65.39.204.101',
      '64.34.165.219',
      '207.200.58.106',
      '46.165.204.131',
      '209.250.31.24',
      '46.21.158.71',
      '41.215.241.2',
      '89.106.180.88',
      '200.143.186.102',
      '82.103.128.72',
      '77.240.1.167',
      '118.127.32.142',
      '204.2.244.11',
      '208.115.48.254',
      '216.155.155.180',
      '72.35.68.130',
      '83.166.171.124',
      '203.142.28.181',
      '38.109.170.52',
      '208.115.62.233',
      '74.63.64.50',
      '69.90.184.70',
      '203.142.12.23',
      '209.223.236.254',
      '65.39.172.34',
      '206.51.231.18',
      '208.93.114.67',
      '208.115.62.177',
      '118.88.21.38',
      '72.35.68.148',
      '209.190.168.38',
      '111.90.138.215',
      '208.85.242.248',
      '68.16.117.54',
      '64.120.14.114',
      '173.254.192.53',
      '64.39.226.84',
      '208.79.212.147',
      '202.157.191.85',
      '76.74.136.170',
      '65.39.204.102',
      '64.34.171.99',
      '207.200.58.107',
      '46.165.225.142',
      '209.166.131.116',
      '46.21.158.72',
      '41.215.241.90',
      '94.229.65.194',
      '69.90.42.98',
      '82.103.128.77',
      '99.192.170.50',
      '203.12.0.91',
      '208.115.62.171',
      '204.2.244.12',
      '216.155.155.181',
      '72.35.68.138',
      '83.166.171.125',
      '216.230.228.34',
      '199.36.111.228',
      '208.115.62.220',
      '74.63.64.49',
      '69.90.184.71',
      '222.73.34.61',
      '209.223.236.170',
      '65.39.172.36',
      '206.51.225.159',
      '76.74.136.171',
      '208.93.114.68',
      '208.115.53.131',
      '208.88.49.114',
      '72.35.68.149',
      '122.99.116.250',
      '111.90.151.35',
      '198.241.44.148',
      '208.115.62.214',
      '69.147.242.18',
      '212.34.134.205',
      '93.158.114.140',
      '208.79.212.148',
      '83.133.121.221',
      '208.115.62.179',
      '65.39.204.103',
      '64.34.164.186',
      '207.200.58.108',
      '64.71.140.50',
      '209.166.131.117',
      '208.115.62.200',
      '41.215.241.98',
      '94.229.65.195',
      '69.90.42.99',
      '82.103.129.140',
      '99.192.170.51',
      '118.127.32.143',
      '208.115.62.172',
      '216.155.155.182',
      '72.35.68.139',
      '83.166.171.121',
      '216.230.228.35',
      '199.36.105.2',
      '208.115.62.221',
      '74.63.64.101',
      '69.90.184.72',
      '203.142.12.24',
      '209.144.26.50',
      '65.39.172.37',
      '81.218.234.139',
      '76.74.136.172',
      '208.93.114.69',
      '208.115.62.178',
      '208.88.49.115',
      '72.35.68.150',
      '122.99.116.251',
      '208.66.76.58',
      '198.241.44.149',
      '208.115.62.215',
      '173.208.80.66',
      '212.34.152.221',
      '91.236.116.216',
      '208.79.212.149',
      '83.133.119.194',
      '208.115.62.191',
      '65.39.204.104',
      '64.34.171.27',
      '207.200.58.109',
      '64.71.140.52',
      '209.166.131.118',
      '208.115.62.235',
      '196.201.6.111',
      '94.229.65.196',
      '69.90.42.100',
      '67.58.96.42',
      '99.192.170.52',
      '203.12.0.184',
      '204.2.244.10',
      '216.155.155.183',
      '72.35.68.140',
      '83.166.171.118',
      '216.230.228.36',
      '199.36.105.3',
      '208.115.62.222',
      '66.90.103.125',
      '69.90.184.73',
      '77.79.11.10',
      '209.144.26.51',
      '85.192.33.31',
      '81.218.234.140'))

  sort_key: [date]    
  sql_trigger_value: select currentdate

  fields:
  - measure: count
    type: count
    drill_fields: detail*

  - dimension: economistonline_hit_data_unique_visitors
    type: int
    sql: ${TABLE}."economistonline_hit_data.unique_visitors"

  - dimension: economistonline_hit_data_unique_views
    type: int
    sql: ${TABLE}."economistonline_hit_data.unique_views"

  sets:
    detail:
      - economistonline_hit_data_unique_visitors
      - economistonline_hit_data_unique_views

